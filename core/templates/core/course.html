{% extends 'core/base.html' %}
{% block title %}Мой курс{% endblock %}

{% block content %}
<div class="course-layout" x-data="{ openModules: {}, active: null }">
    <!-- ЛЕВАЯ ПАНЕЛЬ -->
    <aside class="course-sidebar">
        <div class="course-sidebar-header">
            <a href="{% url 'core:index' %}" class="logo">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5c-1.746 0-3.332.477-4.5 1.253m14 0C18.168 5.477 16.582 5 14.835 5c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
                EduPlatform
            </a>
        </div>

        <nav class="course-sidebar-nav">
            {% for module in modules %}
            <div x-data="{ open: false }">
                <button 
                    class="module-toggle"
                    @click="open = !open"
                    :class="{ 'open': open }"
                >
                    {{ module.title }}
                    <span x-text="open ? '−' : '+'"></span>
                </button>

                <ul class="lesson-list" x-show="open" x-collapse>
                    {% for lesson in module.lesson_list %}
                    <li>
                        <button
                            hx-get="{% url 'core:partial_lesson_detail' lesson.id %}"
                            hx-target="#main-content"
                            hx-swap="innerHTML"
                            @click="active = '{{ lesson.id }}'"
                            :class="{ 'active': active === '{{ lesson.id }}' }"
                        >
                            {{ lesson.title }}
                            {% if lesson.id in completed_lessons %}
                            <svg class="completed-icon" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            {% endif %}
                        </button>
                    </li>
                    {% endfor %}

                    {% if module.test_list %}
                    <li class="test-link">
                        <button
                            hx-get="{% url 'core:partial_test_module' module.id %}"
                            hx-target="#main-content"
                            hx-swap="innerHTML"
                            @click="active = 'test-{{ module.id }}'"
                            :class="{ 'active': active === 'test-{{ module.id }}' }"
                        >
                            Итоговый тест
                        </button>
                    </li>
                    {% endif %}
                </ul>
            </div>
            {% endfor %}
        </nav>
    </aside>

    <!-- ПРАВАЯ ЧАСТЬ -->
    <main class="course-content" id="main-content">
        <div class="welcome-card">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
            </svg>
            <h2>Готов учиться?</h2>
            <p>Выбери урок слева — и начнём!</p>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ progress_percentage }}%"></div>
            </div>
            <p style="margin-top: 1rem; font-weight: 600;">Прогресс: {{ progress_percentage }}%</p>
        </div>
    </main>
</div>
{% endblock %}